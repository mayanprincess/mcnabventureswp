{#
  Multimedia Component
  Display media gallery with tabs (Photos/Videos) and carousel pagination

  Expected variables:
  - title (string): Component title, default "Multimedia"
  - tabs (array): Tab items with 'name', 'gallery_type', 'gallery', and 'videos'
  - itemsPerPage (int): Number of items per carousel page, default 4

  Tab structure:
  {
    name: 'Photos',
    gallery_type: 'gallery' | 'videos',
    gallery: [{ ID, url, alt, ... }],  // for gallery_type: 'gallery'
    videos: [{ video_url, video_title }]  // for gallery_type: 'videos'
  }
#}

{% set title = title|default('Multimedia') %}
{% set tabs = tabs|default([]) %}
{% set itemsPerPage = itemsPerPage|default(4) %}

<section class="multimedia" data-multimedia>
  {# Header: Title + Tab Toggle #}
  <div class="multimedia__header">
    <h2 class="multimedia__title">{{ title }}</h2>

    {% if tabs|length > 1 %}
      <div class="multimedia__tab-list">
        {% for tab in tabs %}
          <button
            class="multimedia__tab {% if loop.first %}is-active{% endif %}"
            data-tab-index="{{ loop.index0 }}"
            aria-label="Ver {{ tab.name }}"
            type="button"
          >
            {{ tab.name }}
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  {# Gallery Grids - One per tab #}
  <div class="multimedia__galleries">
    {% for tab in tabs %}
      {% set tabItems = [] %}

      {# Collect items based on gallery_type #}
      {% if tab.gallery_type == 'gallery' and tab.gallery %}
        {# Photo Gallery: Extract images #}
        {% for image in tab.gallery %}
          {% set tabItems = tabItems|merge([{
            type: 'image',
            url: image.url,
            alt: image.alt|default(''),
            id: image.ID|default('')
          }]) %}
        {% endfor %}
      {% elseif tab.gallery_type == 'videos' and tab.videos %}
        {# Video Gallery: Use video URLs #}
        {% for video in tab.videos %}
          {% set tabItems = tabItems|merge([{
            type: 'video',
            url: video.video_url,
            alt: video.video_title|default('Video')
          }]) %}
        {% endfor %}
      {% endif %}

      <div
        class="multimedia__gallery {% if loop.first %}is-active{% endif %}"
        data-gallery
        data-gallery-index="{{ loop.index0 }}"
      >
        {% if tabItems|length > 0 %}
          {% for item in tabItems %}
            <div
              class="multimedia__item"
              data-item-index="{{ loop.index0 }}"
              data-item-type="{{ item.type }}"
            >
              {% if item.type == 'video' %}
                <video
                  class="multimedia__media"
                  src="{{ item.url }}"
                  loading="lazy"
                ></video>
                <button class="multimedia__play-btn" aria-label="Reproducir video" type="button">
                  <svg class="multimedia__play-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M5 3l14 9-14 9V3z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              {% else %}
                <img
                  class="multimedia__media"
                  src="{{ item.url }}"
                  alt="{{ item.alt }}"
                  loading="lazy"
                >
                {% if loop.first %}
                  <button class="multimedia__play-btn" aria-label="Ver más" type="button">
                    <svg class="multimedia__play-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                {% endif %}
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <div class="multimedia__gallery-empty">
            <p>No hay contenido para esta galería</p>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {# Pagination & Navigation #}
  <div class="multimedia__controls">
    <div class="multimedia__pagination" data-pagination>
      {# Dots will be generated by JavaScript based on active tab #}
    </div>

    <div class="multimedia__navigation">
      <button
        class="multimedia__nav-btn multimedia__nav-btn--prev"
        data-nav="prev"
        aria-label="Página anterior"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button
        class="multimedia__nav-btn multimedia__nav-btn--next"
        data-nav="next"
        aria-label="Página siguiente"
        type="button"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</section>
